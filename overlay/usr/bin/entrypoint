#!/usr/bin/env sh

set -eo pipefail

/usr/local/bin/gomplate -V -o /opt/app/settings.json -f /etc/templates/settings.tmpl

if [ "$ETHERPAD_DB_TYPE" == "mysql" ]
then
    if [ -n "$ETHERPAD_DB_HOST" ]
    then
        printf "Wait for database server on '%s:%s' ...\n" "$ETHERPAD_DB_HOST" "${ETHERPAD_DB_PORT:-3306}"
        /usr/local/bin/wait-for "${ETHERPAD_DB_HOST}":"${ETHERPAD_DB_PORT:-3306}"
    fi
fi

printf "\nStarting Etherpad ...\n"
exec node node_modules/ep_etherpad-lite/node/server.js
